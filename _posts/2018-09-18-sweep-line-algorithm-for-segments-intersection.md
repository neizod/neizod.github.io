---
title: à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¸•à¸±à¸”à¸à¸±à¸™
tags:
  - Geometry
  - Python
  - Algorithm
  - Computer Science
  - Computational Geometry
  - Time Complexity
date: 2018-09-18 22:22:22 +0700
---

[à¸•à¸­à¸™à¸à¹ˆà¸­à¸™][segment intersection]à¹€à¸£à¸²à¹„à¸”à¹‰à¸à¸´à¸ˆà¸²à¸£à¸“à¸²à¸à¸²à¸£à¸•à¸±à¸”à¸à¸±à¸™à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸«à¸™à¸¶à¹ˆà¸‡à¸„à¸¹à¹ˆà¹„à¸›à¹à¸¥à¹‰à¸§ à¸–à¸¶à¸‡à¹à¸¡à¹‰à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸ˆà¸°à¸¡à¸µà¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¸—à¸µà¹ˆà¸„à¹ˆà¸­à¸™à¸‚à¹‰à¸²à¸‡à¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™ à¹à¸•à¹ˆà¹€à¸à¸£à¸²à¸°à¸¡à¸±à¸™à¸¡à¸µà¸ˆà¸³à¸™à¸§à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸§à¸´à¸˜à¸µà¸—à¸µà¹ˆà¸„à¸‡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸³à¹€à¸‚à¹‰à¸²à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£ (à¹€à¸à¸£à¸²à¸°à¹€à¸£à¸²à¸”à¸±à¸™à¸à¸³à¸«à¸™à¸”à¹ƒà¸«à¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸³à¹€à¸‚à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹„à¸›à¹„à¸”à¹‰à¸¡à¸µà¹à¸„à¹ˆà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹€à¸à¸µà¸¢à¸‡à¸ªà¸­à¸‡à¹€à¸ªà¹‰à¸™) à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™à¹€à¸£à¸²à¸­à¸²à¸ˆà¸¡à¸­à¸‡à¸‡à¹ˆà¸²à¸¢à¹† à¸§à¹ˆà¸²à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸”à¸±à¸‡à¸à¸¥à¹ˆà¸²à¸§à¸à¸´à¸™à¹€à¸§à¸¥à¸²à¹€à¸›à¹‡à¸™ $O(1)$ à¹„à¸”à¹‰à¹€à¸¥à¸¢

à¸„à¸³à¸–à¸²à¸¡à¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆà¸à¸§à¹ˆà¸²à¸à¹‡à¸„à¸·à¸­ à¸–à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸³à¹€à¸‚à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹à¸„à¹ˆà¹€à¸à¸µà¸¢à¸‡à¸ªà¸­à¸‡à¹€à¸ªà¹‰à¸™ à¹à¸•à¹ˆà¸¡à¸µà¸¡à¸²à¸à¸–à¸¶à¸‡ $n$ à¹€à¸ªà¹‰à¸™à¸«à¸¥à¸° à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹ƒà¸™à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¸ˆà¸°à¹€à¸›à¹‡à¸™à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ? à¸ªà¸²à¸¡à¸²à¸£à¸–à¸—à¸³à¹„à¸”à¹‰à¸”à¸µà¸à¸§à¹ˆà¸² $O(n^2)$ à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸—à¸¸à¸à¸£à¸¹à¸›à¹à¸šà¸šà¸à¸²à¸£à¸ˆà¸±à¸šà¸„à¸¹à¹ˆà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸¸à¸à¸§à¸´à¸˜à¸µà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?

à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸—à¸µà¹ˆà¸ˆà¸°à¸¡à¸²à¸•à¸­à¸šà¸›à¸±à¸à¸«à¸²à¸™à¸µà¹‰à¸„à¸·à¸­[à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹à¸šà¸šà¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”][sweep line algorithm] à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸«à¸±à¸§à¹ƒà¸ˆà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸¡à¸¡à¸•à¸´à¹€à¸ªà¹‰à¸™à¹ƒà¸™à¸ˆà¸´à¸™à¸•à¸™à¸²à¸à¸²à¸£à¸‚à¸¶à¹‰à¸™à¸¡à¸² (à¸«à¸£à¸·à¸­à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™à¸£à¸°à¸™à¸²à¸šà¸«à¸²à¸à¸à¸´à¸ˆà¸²à¸£à¸“à¸²à¹ƒà¸™à¸¡à¸´à¸•à¸´à¸—à¸µà¹ˆà¸ªà¸¹à¸‡à¸‚à¸¶à¹‰à¸™) à¹à¸¥à¹‰à¸§à¹€à¸¥à¸·à¹ˆà¸­à¸™à¹€à¸ªà¹‰à¸™à¸™à¸±à¹‰à¸™à¸œà¹ˆà¸²à¸™à¸Šà¸¸à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ªà¸™à¹ƒà¸ˆ à¸à¸£à¹‰à¸­à¸¡à¸ªà¸±à¸‡à¹€à¸à¸•à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸ªà¸³à¸„à¸±à¸à¸§à¹ˆà¸²à¸ªà¹ˆà¸‡à¸œà¸¥à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£à¸šà¹‰à¸²à¸‡

{: .oversized .figure}
> ![](/images/algorithm/segment-intersection/sweep-line-algorithm.gif)
>
> à¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¸™à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¸à¸²à¸£à¸•à¸±à¸”à¸à¸±à¸™à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡

à¸ªà¸³à¸«à¸£à¸±à¸š[à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¸à¸²à¸£à¸•à¸±à¸”à¸à¸±à¸™à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡][bentley-ottmann algorithm] à¸¡à¸µà¸«à¸¥à¸±à¸à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‡à¹ˆà¸²à¸¢à¹† à¹‚à¸”à¸¢à¹€à¸£à¸´à¹ˆà¸¡à¸ˆà¸²à¸à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¸—à¸µà¹ˆà¸‚à¸™à¸²à¸™à¸à¸±à¸šà¹à¸à¸™ Y à¹à¸¥à¸°à¸­à¸¢à¸¹à¹ˆà¸—à¸²à¸‡à¸‹à¹‰à¸²à¸¢à¸ªà¸¸à¸”à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¸‹à¸¶à¹ˆà¸‡à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¸™à¸µà¹‰à¸ˆà¸°à¹ƒà¸Šà¹‰à¸ˆà¸”à¸ˆà¸³à¸ªà¸–à¸²à¸™à¸°à¸§à¹ˆà¸²à¸‚à¸“à¸°à¸™à¸±à¹‰à¸™à¸à¸³à¸¥à¸±à¸‡à¸¡à¸­à¸‡à¹€à¸«à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹ƒà¸”à¸­à¸¢à¸¹à¹ˆ (à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¸ˆà¸²à¸à¸¥à¹ˆà¸²à¸‡à¸‚à¸¶à¹‰à¸™à¸šà¸™) à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸™à¸±à¹‰à¸™à¸ˆà¸¶à¸‡à¹€à¸¥à¸·à¹ˆà¸­à¸™à¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¸”à¸±à¸‡à¸à¸¥à¹ˆà¸²à¸§à¹„à¸›à¸—à¸²à¸‡à¸‚à¸§à¸²à¹€à¸£à¸·à¹ˆà¸­à¸¢à¹† à¸ˆà¸™à¹€à¸ˆà¸­à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆà¸”à¸±à¸‡à¸™à¸µà¹‰ (à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¹ƒà¸™à¸•à¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ à¸ˆà¸°à¸›à¸£à¸°à¸à¸­à¸šà¸”à¹‰à¸§à¸¢à¸ˆà¸¸à¸”à¸›à¸¥à¸²à¸¢à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸šà¸ˆà¸²à¸à¸‹à¹‰à¸²à¸¢à¹„à¸›à¸‚à¸§à¸²)

1. à¹€à¸¡à¸·à¹ˆà¸­à¸–à¸¶à¸‡à¸ˆà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹ƒà¸«à¸¡à¹ˆ:
   - à¹à¸—à¸£à¸à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹€à¸ªà¹‰à¸™à¹ƒà¸«à¸¡à¹ˆà¸¥à¸‡à¹„à¸›à¹ƒà¸™à¸ªà¸–à¸²à¸™à¸°
   - à¸„à¸³à¸™à¸§à¸“à¸ˆà¸¸à¸”à¸•à¸±à¸”à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹ƒà¸«à¸¡à¹ˆà¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸•à¸´à¸”à¸à¸±à¸™à¹ƒà¸™à¸ªà¸–à¸²à¸™à¸° à¹à¸¥à¹‰à¸§à¹€à¸à¸´à¹ˆà¸¡à¸¥à¸‡à¹ƒà¸™à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ
2. à¹€à¸¡à¸·à¹ˆà¸­à¸–à¸¶à¸‡à¸ˆà¸¸à¸”à¸ˆà¸šà¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹€à¸”à¸´à¸¡:
   - à¸¥à¸šà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸™à¸±à¹‰à¸™à¸—à¸´à¹‰à¸‡à¹„à¸›
   - à¸„à¸³à¸™à¸§à¸“à¸ˆà¸¸à¸”à¸•à¸±à¸”à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¹à¸¥à¸°à¸•à¸²à¸¡à¸«à¸¥à¸±à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸‡à¸¥à¸šà¹„à¸› à¹à¸¥à¹‰à¸§à¹€à¸à¸´à¹ˆà¸¡à¸¥à¸‡à¹ƒà¸™à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ
3. à¹€à¸¡à¸·à¹ˆà¸­à¸–à¸¶à¸‡à¸ˆà¸¸à¸”à¸•à¸±à¸”à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡:
   - à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ˆà¸¸à¸”à¸•à¸±à¸”à¸—à¸µà¹ˆà¸à¸š
   - à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸™à¸ªà¸–à¸²à¸™à¸°à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¸•à¸±à¸”à¸à¸±à¸™
   - à¸„à¸³à¸™à¸§à¸“à¸ˆà¸¸à¸”à¸•à¸±à¸”à¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¸•à¸´à¸”à¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸‡à¸ªà¸¥à¸±à¸šà¸—à¸µà¹ˆà¹„à¸› à¹à¸¥à¹‰à¸§à¹€à¸à¸´à¹ˆà¸¡à¸¥à¸‡à¹ƒà¸™à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ

à¸ªà¸±à¸‡à¹€à¸à¸•à¸§à¹ˆà¸²à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸­à¸·à¹ˆà¸™à¹† à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¹€à¸«à¸™à¸·à¸­à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆ à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡à¸œà¸¥à¸à¸£à¸°à¸—à¸šà¸•à¹ˆà¸­à¸ªà¸–à¸²à¸™à¸°à¹à¸¥à¸°à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¹€à¸¥à¸¢

à¸«à¸²à¸à¹€à¸¥à¸·à¸­à¸à¹ƒà¸Šà¹‰à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸¡à¸µà¸›à¸£à¸°à¸ªà¸´à¸—à¸˜à¸´à¸ à¸²à¸à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¹ƒà¸™à¸à¸²à¸£à¹€à¸à¹‡à¸šà¸ªà¸–à¸²à¸™à¸°à¹à¸¥à¸°à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ (à¹€à¸Šà¹ˆà¸™ [à¸•à¹‰à¸™à¹„à¸¡à¹‰à¸„à¹‰à¸™à¸«à¸²à¹à¸šà¸šà¸—à¸§à¸´à¸ à¸²à¸„][binary search tree]) à¹€à¸£à¸²à¸ˆà¸°à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸à¸´à¹ˆà¸¡ à¸¥à¸š à¹à¸¥à¸°à¸„à¹‰à¸™à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰à¹ƒà¸™à¹€à¸§à¸¥à¸² $O(\log n)$ à¸‹à¸¶à¹ˆà¸‡à¸™à¸µà¹ˆà¸„à¸·à¸­à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹ƒà¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¹à¸•à¹ˆà¸¥à¸°à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¹€à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸›à¸à¸šà¸à¸±à¸šà¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸—à¸µà¹ˆà¸ªà¸™à¹ƒà¸ˆ à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¹€à¸£à¸²à¸¡à¸µà¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¸—à¸µà¹ˆà¸ªà¸™à¹ƒà¸ˆà¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸­à¸¢à¸¹à¹ˆ $2n$ à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œ (à¸ˆà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¹à¸¥à¸°à¸ˆà¸¸à¸”à¸ˆà¸šà¸‚à¸­à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡) à¹à¸¥à¸°à¸¡à¸µà¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¹€à¸à¸´à¹ˆà¸¡à¸¡à¸²à¸­à¸µà¸ $k$ à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸“à¹Œà¹€à¸¡à¸·à¹ˆà¸­à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹ƒà¸”à¹† à¹€à¸à¸´à¸”à¸à¸²à¸£à¸•à¸±à¸”à¸à¸±à¸™ à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™à¹€à¸§à¸¥à¸²à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸ˆà¸¶à¸‡à¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™ $O((n+k)\log n)$ ... à¸à¸­à¹€à¸«à¹‡à¸™à¹à¸šà¸šà¸™à¸µà¹‰à¹à¸¥à¹‰à¸§à¸à¹‡à¹à¸™à¹ˆà¸™à¸­à¸™à¸§à¹ˆà¸² à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸‚à¸­à¸‡à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹à¸šà¸š[à¸‚à¸¶à¹‰à¸™à¸à¸±à¸šà¸‚à¸™à¸²à¸”à¸„à¸³à¸•à¸­à¸š][output sensitive]

à¹à¸¥à¸°à¹€à¸¡à¸·à¹ˆà¸­à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸•à¹ˆà¸­à¹„à¸›à¸ˆà¸°à¸à¸šà¸§à¹ˆà¸² à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹ƒà¸”à¹† à¸•à¸±à¸”à¸à¸±à¸šà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸­à¸·à¹ˆà¸™à¹„à¸”à¹‰à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸” $n-1$ à¸„à¸£à¸±à¹‰à¸‡ à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™à¸ˆà¸¶à¸‡à¸¡à¸µà¸ˆà¸¸à¸”à¸•à¸±à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸”à¹‰à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹€à¸›à¹‡à¸™ $k=O(n^2)$ à¸«à¸£à¸·à¸­à¸à¸¥à¸±à¸šà¸à¸¥à¸²à¸¢à¹€à¸›à¹‡à¸™à¸§à¹ˆà¸²à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸™à¸µà¹‰à¸ˆà¸°à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸—à¸¸à¸à¸„à¸¹à¹ˆà¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¹€à¸ªà¸µà¸¢à¸­à¸µà¸ à¹à¸•à¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹‚à¸¥à¸à¸ˆà¸£à¸´à¸‡à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸¡à¸±à¸à¸¡à¸µà¸à¸²à¸£à¸à¸£à¸°à¸ˆà¸²à¸¢à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸›à¸£à¸°à¸›à¸£à¸²à¸¢ à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸–à¸¹à¸à¸ªà¸¸à¹ˆà¸¡à¸à¸£à¸°à¸ˆà¸²à¸¢à¸•à¸±à¸”à¸à¸±à¸™à¸¡à¸²à¸à¸¡à¸²à¸¢à¹à¸šà¸š[à¸‡à¸²à¸™à¸¨à¸´à¸¥à¸›à¹Œà¸‚à¸­à¸‡ Jackson Pollock][jackson pollock] à¸—à¸³à¹ƒà¸«à¹‰à¹‚à¸”à¸¢à¸—à¸±à¹ˆà¸§à¹„à¸›à¹à¸¥à¹‰à¸§ à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸™à¸µà¹‰à¹„à¸¡à¹ˆà¸„à¸§à¸£à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¹à¸¢à¹ˆà¸à¸§à¹ˆà¸²à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸—à¸¸à¸à¸„à¸¹à¹ˆà¸™à¸±à¹ˆà¸™à¹€à¸­à¸‡

{: .figure}
> ![](/images/algorithm/segment-intersection/half-dense-half-sparse-example.png)
>
> à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸³à¹€à¸‚à¹‰à¸²à¸—à¸µà¹ˆà¸¡à¸µà¸„à¸§à¸²à¸¡à¸«à¸™à¸²à¹à¸™à¹ˆà¸™à¹€à¸›à¹‡à¸™à¸«à¸¢à¹ˆà¸­à¸¡à¹† à¹à¸•à¹ˆà¹ƒà¸™à¸ à¸²à¸à¸£à¸§à¸¡à¹à¸¥à¹‰à¸§à¸¢à¸±à¸‡à¸¡à¸µà¸„à¸§à¸²à¸¡à¹‚à¸›à¸£à¹ˆà¸‡à¸­à¸¢à¸¹à¹ˆ à¸—à¸³à¹ƒà¸«à¹‰à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹à¸šà¸šà¹€à¸ªà¹‰à¸™à¸à¸§à¸²à¸”à¸¢à¸±à¸‡à¸„à¸‡à¸—à¸³à¸‡à¸²à¸™à¹„à¸”à¹‰à¸”à¸µà¸à¸§à¹ˆà¸²à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸šà¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸—à¸¸à¸à¸„à¸¹à¹ˆ

... à¸­à¸˜à¸´à¸šà¸²à¸¢à¸ˆà¸šà¹à¸¥à¹‰à¸§ à¹à¸›à¸°à¹‚à¸„à¹‰à¸”à¹„à¸”à¹‰ ğŸ˜œ

``` python
from collections import namedtuple
from blist import blist, sortedlist     # pip install blist

Point = namedtuple('Point', 'x y')

Segment = namedtuple('Segment', 'p q')
Segment.from_floats = lambda x0, y0, x1, y1: Segment.from_points(Point(x0, y0), Point(x1, y1))
Segment.from_points = lambda p, q: Segment(*sorted([p, q]))
Segment.ccw = lambda self, p: Triangle(p, *self).ccw()
Segment.cut = lambda self, other: self.ccw(other.p) ^ self.ccw(other.q)
Segment.det = lambda self: self.p.x*self.q.y - self.p.y*self.q.x
Segment.dx = lambda self: self.p.x - self.q.x
Segment.dy = lambda self: self.p.y - self.q.y

Pair = namedtuple('Pair', 's t')
Pair.from_segments = lambda s, t: Pair(*sorted([s, t]))
Pair.denominator = lambda self: self.s.dx()*self.t.dy() - self.s.dy()*self.t.dx()
Pair.is_intersect = lambda self: self.s.cut(self.t) and self.t.cut(self.s)
Pair.intersect_coord = ( lambda self:
          None if not self.is_intersect() else
          Point( (self.s.det()*self.t.dx() - self.s.dx()*self.t.det()) / self.denominator(),
                 (self.s.det()*self.t.dy() - self.s.dy()*self.t.det()) / self.denominator() ))

Triangle = namedtuple('Triangle', 'u v w')
Triangle.ccw = lambda self: round(self.det(), 9) > 0
Triangle.det = lambda self: ( self.u.x*self.v.y - self.u.y*self.v.x +
                              self.v.x*self.w.y - self.v.y*self.w.x +
                              self.w.x*self.u.y - self.w.y*self.u.x )

AddEvent = namedtuple('AddEvent', 'p s t')      # dummy 3rd attr
AddEvent.from_segment = lambda s: AddEvent(s.p, s, s)

DelEvent = namedtuple('DelEvent', 'p s t')      # dummy 3rd attr
DelEvent.from_segment = lambda s: DelEvent(s.q, s, s)

IntersectEvent = namedtuple('IntersectEvent', 'p s t')
IntersectEvent.from_segments = lambda s, t: IntersectEvent.from_pair(Pair.from_segments(s, t))
IntersectEvent.from_pair = lambda ps: IntersectEvent(ps.intersect_coord(), *ps)


def init_events(segments):
    events = sortedlist()
    for s in segments:
        events.add(AddEvent.from_segment(s))
        events.add(DelEvent.from_segment(s))
    return events

def add_intersect_event(i, j, status, events):
    if 0 <= i < len(status) and 0 <= j < len(status):
        intersection = IntersectEvent.from_segments(status[i], status[j])
        if ( intersection.p is not None
                and intersection not in events
                and events[0].p <= intersection.p <= events[-1].p ):
            events.add(intersection)

def ccw_bin_search(event, status):
    lo = 0
    hi = len(status)
    while lo < hi:
        i = (lo+hi) // 2
        if status[i].ccw(event.p):
            lo = i + 1
        else:
            hi = i
    return lo

def add_status(event, status):
    i = ccw_bin_search(event, status)
    status.insert(i, event.s)
    return i

def del_status(event, status):
    i = ccw_bin_search(event, status)
    del status[i]
    return i

def sweep(segments):
    intersections = set()
    status = blist()
    events = init_events(segments)
    while events:
        if isinstance(events[0], AddEvent):
            i = add_status(events[0], status)
            add_intersect_event(i, i-1, status, events)
            add_intersect_event(i, i+1, status, events)
        elif isinstance(events[0], DelEvent):
            i = del_status(events[0], status)
            add_intersect_event(i-1, i, status, events)
        else:
            intersections.add(Pair(events[0].s, events[0].t))
            i = ccw_bin_search(events[0], status)
            status[i], status[i+1] = status[i+1], status[i]
            add_intersect_event(i-1, i-0, status, events)
            add_intersect_event(i+1, i+2, status, events)
        del events[0]
    return intersections


# example
from timeit import timeit
from random import random as r
from itertools import combinations
import matplotlib.pyplot as plt

def brute_force(segments):
    intersections = set()
    for s, t in combinations(segments, 2):
        ps = Pair.from_segments(s, t)
        if ps.intersect_coord() is not None:
            intersections.add(ps)
    return intersections

segments = [ Segment.from_floats(i+r(), j+r(), i+r(), j+r())
                 for i in range(3) for j in range(3) for _ in range(100) ]
plt.plot(*(pair for a, b in segments for pair in [(a.x, b.x), (a.y, b.y)]))
plt.savefig('output.png')

def test_sw():
    global answer_sw
    answer_sw = sweep(segments)

def test_bf():
    global answer_bf
    answer_bf = brute_force(segments)

time_sw = timeit(test_sw, number=1)
time_bf = timeit(test_bf, number=1)
print('Output is the same?', answer_sw == answer_bf)    # should be True
print('Time sweep line:', time_sw, 'second')            # ~1.0s
print('Time brute force:', time_bf, 'second')           # ~3.0s
```


[segment intersection]: /2018/09/13/check-intersection-of-one-segment-pair.html
[sweep line algorithm]: //en.wikipedia.org/wiki/Sweep_line_algorithm
[bentley-ottmann algorithm]: //en.wikipedia.org/wiki/Bentley%E2%80%93Ottmann_algorithm
[binary search tree]: //en.wikipedia.org/wiki/Binary_search_tree
[output sensitive]: //en.wikipedia.org/wiki/Output-sensitive_algorithm
[jackson pollock]: //en.wikipedia.org/wiki/Jackson_Pollock
